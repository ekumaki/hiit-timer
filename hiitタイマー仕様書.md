# アプリ仕様書（最終版）
## 1. 目的と背景
- 目的：HIIT（高強度インターバルトレーニング）用に**視認性が高く、操作が少ない**タイマーを提供し、トレーニングの集中度を高める。
- 背景：既存ツールの広告・過剰機能・視認性不足を解消。**中央の大きな残り秒数**、**背景色で状態区別**、**円形プログレス**、**PWA対応**を重視。

## 2. 対象ユーザー／利用シーン
- 対象ユーザー：個人利用（当面は作成者本人）。
- 利用シーン：自宅・ジム。スマホ/PCとも**縦長（ポートレート）前提の共通レイアウト**で使用。
- 表示言語：**日本語**（端末言語に依存せず固定）。

## 3. スコープ（含む／含まない）
- 含む：
  - 残り秒数の中央大表示（最小128px相当）
  - 運動/休憩の自動切替（背景色で区別）
  - 運動秒数・休憩秒数・ラウンド数の**メイン画面での設定**
  - **円形プログレス**で残り時間可視化（単色=#FFFFFF・太さ=幅の6%、点滅なし）
  - **PWA対応**（Service Worker/Manifest）
  - 効果音/バイブ通知（開始・切替・終了、残り3秒のカウントダウン音）
  - 効果音ON/OFFボタン（スピーカーアイコン斜線切替、バイブも連動）
- 含まない：
  - ダーク/ライト自動切替
  - 複数インターバル編集
  - ワークアウト履歴・統計
  - 共有/同期（クラウド）
  - 外部デバイス連携
  - 完了画面
  - 設定専用パネル（モーダル）

## 4. 機能要件
- 必須
  - 開始/一時停止の単一トグルボタン（ラベル/アイコン切替）、リセット（※一時停止時のみ有効）
  - 運動→休憩をラウンド数に応じて自動遷移
  - 入力：運動・休憩・ラウンド数（メイン画面上、初回デフォルト=20秒/10秒/8ラウンド）
  - 表示：中央に残り秒数（フォント=`min(26vw,196px)`）、円形プログレス、現在フェーズ、ラウンド`n / N`
  - 背景色：運動=#E53935／休憩=#1E88E5／待機=#BDBDBD
  - 効果音/バイブ
    - 残り3,2,1秒=短いビープ（実機で調整、初期値440Hz/200ms）
    - 開始/終了=やや長めのビープ（初期値440Hz/350ms）
    - バイブパターン：3-2-1=各100ms、開始/終了=200ms
    - ミュートONで音/バイブ停止
  - 入力制約：運動/休憩=5〜600秒（整数）、ラウンド=1〜50。無効時は「5〜600の整数を入力してください」を表示、開始ボタン非活性。
  - 入力ボタン（±）：±1単位、長押しで連続加算/減算
  - オフライン動作（PWA）、初回アクセスでアセットキャッシュ
  - バックグラウンド復帰時：実時間差で補正（精度担保）
- 望ましい
  - 全画面表示（Fullscreen API）
  - 画面スリープ防止（Screen Wake Lock API）
- 将来
  - プリセット保存（ローカル）

## 5. 画面仕様
- 構成：メイン画面のみ（縦長レイアウト）
  - 上部：フェーズラベル（WORK/REST）、ラウンド`n / N`
  - 中央：残り秒数＋円形プログレス
  - 下部：
    - 入力群（運動・休憩・ラウンド）
    - 操作群
      - 中央大ボタン：開始/一時停止（単一トグル）
      - 左：リセット（小・一時停止時のみ有効）
      - 右：ミュート（小・アイコン斜線切替）
      - 全画面：任意（右上など）
- レスポンシブ：幅狭時は入力群を2段折返し。残り秒数は`min(26vw,196px)`基準で拡縮。
- アクセシビリティ：色に頼らない状態表示、背景に応じてテキスト色を黒/白自動切替、コントラスト比4.5:1以上。

## 6. データ仕様
- エンティティ
  - `Settings`：{ workSec:int, restSec:int, rounds:int, muted:boolean }
- 保存方式：localStorage（キー例：`hiit.settings.v1`）、起動時に最後の設定を復元。
- 保持/削除：設定リセットで削除。
- 個人情報：扱わない。

## 7. 非機能要件
- 性能：P95応答<300ms、初回ロード<2s/4G、バンドル≤150KB gzip
- 精度：タイマー鳴動誤差±50ms（目標値）
- 可用性：オフラインファースト（重要アセット事前キャッシュ）
- セキュリティ：HTTPS配信（GitHub Pages）、CSP（仮）、外部トラッキングなし
- 運用：GitHub Pages手動デプロイ（公開パス=/hiit-timer/）
- 法令/規約：権限取得の明示、クッキー不使用
- PWAメタ
  - `name`/`short_name`: "HIITタイマー"
  - `lang`: ja、`dir`: ltr
  - `start_url`: . 、`scope`: . 、`display`: standalone
  - `theme_color`/`background_color`: #1E88E5
  - `icons`: 192/512px PNG（白リング+"HIIT"、余白10〜12%）
  - `display_override`: standaloneのみ
- キャッシュ戦略：Stale-While-Revalidate

## 8. 外部連携
- 外部APIなし
- ブラウザAPI：Audio/Vibration/Fullscreen/Screen Wake Lock（非対応は無視）

## 9. 権限/認可
- ロール：単一ユーザー（匿名）
- 権限：音・バイブ・Wake Lock（任意）

## 10. 品質・運用
- テスト観点
  - 入力制約（5/600、1/50）
  - 遷移・鳴動（開始/終了/残り3-2-1）
  - 単一トグルの切替と誤操作防止
  - ミュート連動（音/バイブOFF）
  - バックグラウンド復帰補正
  - PWA（インストール・オフライン起動）
  - レイアウト（ポートレート共通で崩れなし）
  - リセットが一時停止時のみ有効
- 受入基準
  - 作者の主要端末（スマホ/PC）で全機能正常動作
  - 3-2-1カウントダウンが遅延なく聞こえる
- 監視/ログ：解析なし、エラー未捕捉なし
- リリース：GitHub Pagesへ配置

## 11. リスク・前提・制約
- リスク：省電力・バックグラウンド制限で音/バイブ遅延、ブラウザ差異
- 前提：初回オンライン時にキャッシュ完了
- 制約：バックグラウンドでの鳴動はOS/ブラウザ依存

## 12. 変更履歴
- v7までの要件を統合し、最終版として確定

---

